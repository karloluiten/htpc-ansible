---
- name: SSH folder voor root
  file: path="/root/.ssh" state=directory

- name: SSH Authorized_keys voor root
  copy: src=authorized_keys dest=/root/.ssh/authorized_keys

- copy: src=sshd_config dest=/etc/ssh/sshd_config
  notify:
  - restart ssh

- group: name=admin system=yes
  tags: user

- name: Create group for main user
  group:
    name: wijnand

- name: Create main user
  user:
    name: wijnand
    shell: "/bin/bash"
    group: admin
    groups: wijnand
    append: yes
    password: "{{ encrypted_ssh_password }}"
    update_password: always
    generate_ssh_key: yes
    ssh_key_type: rsa
    ssh_key_file: "/home/wijnand/.ssh/id_rsa"
  tags: user

# - user: name=wijnand comment="Wijnand" uid=1109 password={{ encrypted_ssh_password }} shell="/bin/bash" state=present group=wijnand groups=admin append=yes generate_ssh_key=yes ssh_key_file="/home/wijnand/.ssh/id_rsa" ssh_key_type=rsa update_password=always
#   tags: user

- name: set sudoers file
  copy: src=sudoers dest=/etc/sudoers
  tags: sudo

- name: SSH folder voor wijnand
  file: path="/home/wijnand/.ssh" state=directory group="wijnand" owner="wijnand" mode="0700"

- name: SSH Authorized_keys voor wijnand
  copy: src=authorized_keys dest=/home/wijnand/.ssh/authorized_keys  group="wijnand" owner="wijnand" mode="0600"

- name: Enable SSHD
  service: name=ssh enabled=yes
